
@using Insite.Admin.Models
@model RelationshipsViewModel

<div isa-finger-tab-content class="vertical grid-block finger-tab-content">
    <isa-relationships collection-name="@Model.CollectionName"
                       default-sort="@Model.Form.DefaultSortProperty"
                       default-sort-ascending="@Model.Form.DefaultSortIsAscending"
                       many-to-many-pluralized-entity-name="@Model.ManyToManyPluralizedEntityName"
                       system-list-value-id="@Model.SystemListValueId"
                       page-size="@Model.PageSize"
                       parent-entity-id="entityDetailsCtrl.entityId"
                       parent-id-column="@Model.ParentIdColumn" 
                       pluralized-entity-name="@Model.EntityDefinition.PluralizedName" 
                       properties-to-select="@Model.PropertiesToSelect"
                       related-entity-id-column="@Model.RelatedEntityIdColumn"
                       relationship-type="@Model.RelationshipType"
                       class="grid-block"></isa-relationships>

    <script type="text/ng-template" id="relationships-@Model.CollectionName-@Model.RelationshipType">
        <div ng-cloak ng-if="entityListCtrl.displayList" class="grid-block">
            @Html.Partial("EntityList", new EntityListModel
       {
           OverriddenInstructionalText = Model.InstructionalText,
           Title = "Product - " + Model.Label,
           SingularTitle = "Product - " + Model.Label,
           EntitiesViewModel = Model,
           ShowSelectColumn = Model.CanEdit,
           Buttons =@<text>
                        @if (Model.CanEdit)
                        {
                            <span class="right">
                                <span ng-if="entityListCtrl.areNoneSelected()">
                                    <a class="button" disabled>Unassign</a>
                                    <a class="button" ng-click="entityListCtrl.assignEntities()">Assign @Model.Label</a>
                                </span>
                                <span ng-if="!entityListCtrl.areNoneSelected()">
                                    <a class="button" ng-click="entityListCtrl.unassignSelected()">Unassign</a>
                                    <a class="button" disabled>Assign @Model.Label</a>
                                </span>
                            </span>
                        }
                     </text>
       })
        </div>
        <div ng-if="!entityListCtrl.displayList">
            <p class="list-unavailable">This @Model.EntityDefinition.Label needs to be saved before you may assign @Model.Label.</p>
        </div>
        @if (Model.CanEdit)
        {
            @Html.Partial("AddRelationships")
        }
    </script>
</div>